<!-- Box -->
<div class="box">
	<!-- Box Head -->
	<div class="box-head">
		<% if @edit_type == "Edit Checked" %>
			<h2 class="left">Edit Multiple Exam Marks</h2>
		<% elsif @edit_type == "Edit by Subject" %>
			<h2 class="left">Edit Multiple Exam Mark By Examination - <%=@subject_name%></h2>
		<% end %>
	</div>
</div>


<div class="tlist">
<% form_for :exammark, :url => update_multiple_exammarks_path, :html => {:method => :put} do |f| %>
<!--<table><tr><th></th></tr></table> -->	
	<table>
		<% %>
		<tr>
			<th>Student</th>
			<th>Mykad No</th>
			<th>Total MCQ</th>
				<% @examid = @exammarks[0].exam_id %>
				<% @mcqcount = Examquestion.find(:all, :joins=> :exams, :conditions=>['questiontype=? and exam_id=?',"MCQ", @examid ]).count %>
				<% @meqcount = Examquestion.find(:all, :joins=> :exams, :conditions=>['questiontype=? and exam_id=?',"MEQ", @examid ]).count %>
				<% @seqcount = Examquestion.find(:all, :joins=> :exams, :conditions=>['questiontype=? and exam_id=?',"SEQ", @examid ]).count %>
				<% @acqcount = Examquestion.find(:all, :joins=> :exams, :conditions=>['questiontype=? and exam_id=?',"ACQ", @examid ]).count %>
			<% 1.upto(@mcqcount) do |count|%>
				<th>MCQ-Q <%=count%></th>
			<% end %>
			<% 1.upto(@meqcount) do |count|%>
				<th>MEQ-Q <%=count%></th>
			<% end %>
			<% 1.upto(@seqcount) do |count|%>
				<th>SEQ-Q <%=count%></th>
			<% end %>
			<% 1.upto(@acqcount) do |count| %>
				<th>ACQ-Q <%=count%></th>
			<% end %>

		</tr>
		<%# for exammark in @exammarks %>
		<% @exammarks.sort_by{|x|x.studentmark.name}.each do |exammark| %>
			<%= hidden_field_tag "exammark_ids[]", exammark.id %><%#result ==> "grade_ids"=>["4","3","2","1"]  == grade_ids[]  %>
			<%#= exammark.exampaper.examquestions.count %>
			<tr>
			<tr>
				<td><%#=exammark.id%><%=h exammark.studentmark.matrix_name %><%#=h grade.student_id.blank? ? "" : grade.studentgrade.name %></td>
				<td><%=h exammark.studentmark.icno %></td>
<% if @edit_type == "Edit Checked" || @edit_type.nil? %>	
				<!--<td>
		
					<%#= select_tag("subject_ids[]", "<option value="+grade.subject_id.to_s+">"+grade.subjectgrade.subject_code_with_subject_name.to_s+"</option>"+options_from_collection_for_select(Grade.set_subject_for_multiple_edit(grade.student_id), :id, :subject_code_with_subject_name, :selected => grade.subject_id))  %> 

					
				</td>-->
<% elsif @edit_type == "Edit by Subject" %>
	<%#= hidden_field_tag "subject_ids[]", @subject_id %>
	<%= hidden_field_tag "exam_ids[]", @exam_id %>
<% end %>
		
				<td align=right><%= hidden_field_tag "total_mcqs[]", exammark.total_mcq, :size=> 4 %><%=exammark.total_mcq%></td>
				<!--<td>-->
					<%# 0.upto(exammark.marks.count-1) do |cc|%>
						<%#= text_field_tag "marks_attributes[#{cc}][student_marks][]", exammark.marks[cc].student_mark, :size=> 4 %>
						<%#= exammark.marks[cc].id %>
						<%#= exammark.exampaper.examquestions[cc].questiontype %>
					<%# end %>
					<!--question marks order(BY TYPE) : MCQ, MEQ,SEQ,ACQ,OSCI,OSCII,OSCE,OSPE,VIVA-->
					<!--for checking(line 44:use text_field_tag instead):mark id: 
						<%#=Mark.find(:first, :conditions=>['exammark_id=?',exammark.id ]).id%>-->
					<% aaa=exammark.marks %><!--PENDING:DATA IS CORRENT BUT...DISPLAY:sequence of marks-depends on last updated record!-->
					<% aaa.each_with_index do |aa, index|%>
						<td>
							<!--for checking:incase-marks value din not match student name
							<%#= aa.id %>ddd-->
							<%#= hidden_field_tag "marks_attributes[#{index}][exammark_id][]", aa.id %>
							<%= text_field_tag "marks_attributes[#{index}][student_marks][]", aa.student_mark, :size=> 4 %>
						</td>
					<% end %>
					
				<!--</td>-->
			
			</tr>	
		<% end%>
	</table>
<%= f.submit "Submit" %>
<%#= submit_tag "Edit Checked", :name => :grade_submit_button %>
<%#= link_to 'New Grade', new_grade_path(:new_type => "0")%>


<% end %>
</div>

